<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Sankey Diagram</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
</head>

<body>
    <div id="observablehq-chart-fc7acb52"></div>
    <script type="module">
        import { Runtime, Inspector } from "https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js";
        import define from "https://api.observablehq.com/@d3/sankey-diagram.js?v=3";

        const runtime = new Runtime()
        const module = runtime.module(define, name => {
            if (name === "chart") return new Inspector(document.querySelector("#observablehq-chart-fc7acb52"));
        });

        var newLinks = [
            {
                "Source": "PRK",
                "Target": "USA",
                "CAMEOCode": 40
            },
            {
                "Source": "PRK",
                "Target": "USA",
                "CAMEOCode": 46
            },
            {
                "Source": "PRK",
                "Target": "USA",
                "CAMEOCode": 51
            },
            {
                "Source": "PRY",
                "Target": "USA",
                "CAMEOCode": 172
            },
            {
                "Source": "PSE",
                "Target": "USA",
                "CAMEOCode": 10
            },
            {
                "Source": "PTY",
                "Target": "USA",
                "CAMEOCode": 36
            },
            {
                "Source": "RUS",
                "Target": "USA",
                "CAMEOCode": 42
            },
            {
                "Source": "RUS",
                "Target": "USA",
                "CAMEOCode": 36
            },
            {
                "Source": "RUS",
                "Target": "USA",
                "CAMEOCode": 42
            },
            {
                "Source": "SAU",
                "Target": "USA",
                "CAMEOCode": 43
            },
            {
                "Source": "SCG",
                "Target": "USA",
                "CAMEOCode": 51
            },
            {
                "Source": "TJK",
                "Target": "USA",
                "CAMEOCode": 43
            },
            {
                "Source": "TUR",
                "Target": "USA",
                "CAMEOCode": 20
            },
            {
                "Source": "TUR",
                "Target": "USA",
                "CAMEOCode": 32
            },
            {
                "Source": "TUR",
                "Target": "USA",
                "CAMEOCode": 51
            },
            {
                "Source": "TUR",
                "Target": "USA",
                "CAMEOCode": 173
            },
            {
                "Source": "UKR",
                "Target": "USA",
                "CAMEOCode": 42
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 57
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 40
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 46
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 121
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 10
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 13
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 20
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 30
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 36
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 40
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 42
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 51
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 84
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 114
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 120
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 186
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 13
            },
            {
                "Source": "USA",
                "Target": "USA",
                "CAMEOCode": 40
            },
            {
                "Source": "VNM",
                "Target": "USA",
                "CAMEOCode": 40
            },
            {
                "Source": "ZMB",
                "Target": "USA",
                "CAMEOCode": 172
            },
            {
                "Source": "ZMB",
                "Target": "USA",
                "CAMEOCode": 172
            },
            {
                "Source": "ZWE",
                "Target": "USA",
                "CAMEOCode": 40
            },
            {
                "Source": "PRK",
                "Target": "CHN",
                "CAMEOCode": 36
            },
            {
                "Source": "PRK",
                "Target": "CHN",
                "CAMEOCode": 42
            },
            {
                "Source": "REF",
                "Target": "CHN",
                "CAMEOCode": 10
            },
            {
                "Source": "REF",
                "Target": "CHN",
                "CAMEOCode": 12
            },
            {
                "Source": "RUS",
                "Target": "CHN",
                "CAMEOCode": 20
            },
            {
                "Source": "RUS",
                "Target": "CHN",
                "CAMEOCode": 36
            },
            {
                "Source": "SEP",
                "Target": "CHN",
                "CAMEOCode": 43
            },
            {
                "Source": "TIB",
                "Target": "CHN",
                "CAMEOCode": 40
            },
            {
                "Source": "TWN",
                "Target": "CHN",
                "CAMEOCode": 10
            },
            {
                "Source": "TWN",
                "Target": "CHN",
                "CAMEOCode": 110
            },
            {
                "Source": "TWN",
                "Target": "CHN",
                "CAMEOCode": 130
            },
            {
                "Source": "TWN",
                "Target": "CHN",
                "CAMEOCode": 164
            },
            {
                "Source": "USA",
                "Target": "CHN",
                "CAMEOCode": 36
            },
            {
                "Source": "USA",
                "Target": "CHN",
                "CAMEOCode": 42
            },
            {
                "Source": "USA",
                "Target": "CHN",
                "CAMEOCode": 42
            },
            {
                "Source": "VNM",
                "Target": "CHN",
                "CAMEOCode": 42
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 10
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 17
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 30
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 36
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 42
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 43
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 46
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 57
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 60
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 100
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 10
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 46
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 60
            },
            {
                "Source": "RUS",
                "Target": "RUS",
                "CAMEOCode": 10
            },
            {
                "Source": "SPY",
                "Target": "RUS",
                "CAMEOCode": 10
            },
            {
                "Source": "SWE",
                "Target": "RUS",
                "CAMEOCode": 43
            },
            {
                "Source": "TKM",
                "Target": "RUS",
                "CAMEOCode": 20
            },
            {
                "Source": "TUR",
                "Target": "RUS",
                "CAMEOCode": 36
            },
            {
                "Source": "UKR",
                "Target": "RUS",
                "CAMEOCode": 40
            },
            {
                "Source": "UKR",
                "Target": "RUS",
                "CAMEOCode": 36
            },
            {
                "Source": "UKR",
                "Target": "RUS",
                "CAMEOCode": 71
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 42
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 57
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 20
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 20
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 10
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 16
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 20
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 36
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 43
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 51
            },
            {
                "Source": "USA",
                "Target": "RUS",
                "CAMEOCode": 100
            },
            {
                "Source": "VNM",
                "Target": "RUS",
                "CAMEOCode": 42
            },
            {
                "Source": "VNM",
                "Target": "RUS",
                "CAMEOCode": 43
            },
            {
                "Source": "VNM",
                "Target": "RUS",
                "CAMEOCode": 162
            }
        ]

        var newNodes = [{name: "USA", category: 1}, {name: "CHN", category: 2}, {name: "RUS", category: 3}]
        var groupIter = 4;

        function sourceExists(nodes, element){
            var flag = false;

            nodes.forEach(node => {
                if(element.source == node.id){
                    flag = true;
                }
                else{
                    console.log("Still looking for the element..");
                }
            })
            return flag;
        }

        newLinks.forEach(element => {
                if(sourceExists(newNodes, element)){
                    console.log("Skipped source value: " + element.source);
                }
                else{
                    newNodes.push({id: element.source, group: groupIter})
                    groupIter ++
                }
        });

        var newData = {nodes: newNodes, links: newLinks}
        console.log(newData)

        module.redefine("data", newData)
    </script>
</body>
</html>
